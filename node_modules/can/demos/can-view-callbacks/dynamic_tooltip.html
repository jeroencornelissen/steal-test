<style>
    /* use a class instead of disable the button so mouseover events are fired */
	.disabled {
		opacity: 0.5;
	}
</style>
<link rel="stylesheet" href="../../node_modules/jquery-ui/themes/base/all.css" />
<div id="app"></div>
<script type="text/stache" id="demo-html">
<table>
	<thead>
		<td></td><td>Name</td><td>Email</td>
	</thead>
	<tbody>
		{{#each(users)}}
		<tr>
			<td><input on:change="scope.root.toggle(this)" type="checkbox"/></td>
			<td>{{name}}</td>
			<td>{{email}}</td>
		</tr>
		{{/each}}
	</tbody>
	<tfoot>
		<tr>
			<td colspan="3">
				<button tooltip="{{deleteTooltip()}}"
						{{^if(selected.length)}}class="disabled"{{/if}}
						on:click="notImplemented()">
					Delete
				</button>
				<button
					tooltip="{{archiveTooltip()}}"
					{{^if(selected.length)}}class="disabled"{{/if}}
					on:click="notImplemented()">
					Archive
				</button>
			</td>
		</tr>
	</tfoot>
</table>
</script>

<script src="../../node_modules/steal/steal.js" dev-bundle main="@empty">

import { DefineList, DefineMap, domEvents, stache, stacheBindings, viewCallbacks } from "can";
import $ from "jquery";
import "jquery-ui/ui/widgets/tooltip";

viewCallbacks.attr("tooltip", function( el, attrData ) {
	// A helper that updates or sets up the tooltip
	var updateTooltip = function(){
		$(el).tooltip({
			content: el.getAttribute("tooltip"),
			items: "[tooltip]"
		})
	}
	// When the tooltip attribute changes, update the tooltip
	domEvents.addEventListener(el, "attributes", function(ev){
		if(ev.attributeName === "tooltip") {
			updateTooltip();
		}
	});
	// Setup the tooltip
	updateTooltip();

});

var users = new DefineList([
	{ name: "Justin Meyer", email: "justin@bitovi" },
	{ name: "Brian Moschel", email: "brian@bitovi" },
	{ name: "Bitovi", email: "contact@bitovi" },
])

var selected = new DefineList();

var template = stache.from('demo-html');

$("#app").html( template({
	selected: selected,
	users: users,
	toggle: function(user){
		var index = selected.indexOf( user );

		if( index >= 0 ) {
			selected.splice(index, 1)
		} else {
			selected.push(user)
		}
	},
	deleteTooltip: function(){
		var selectedCount = selected.length
		if(selectedCount) {
			return "Delete "+selectedCount+" users";
		} else {
			return "Select users to delete them.";
		}
	},
	archiveTooltip: function(){
		var selectedCount = selected.length;
		if(selectedCount) {
			return "Archive "+selectedCount+" users";
		} else {
			return "Select users to archive them.";
		}
	},
	notImplemented: function(){
		alert("we didn't make this work for this demo")
	}
}) );

</script>
